<!doctype html>
<html lang="en-us">
  <head>
    <title>Redis&amp;Jedis // Ray</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.70.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Ray" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://zyooo.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redis&amp;Jedis"/>
<meta name="twitter:description" content="redis&amp;Jedis redis 概念：一款高性能的NOSQL系列的非关系型数据库
关系型数据库：MySQL、Oracle…
​	使用表单存储数据，数据之间有关联关系，数据存储在硬盘的文件上
非关系型数据库(NOSQL): redis, hbase…
​	使用键值对去存储数据，数据之间没有关联关系，数据存储在内存中
两种数据库并非对立而是互补，关系型用来做数据库，NOSQL用于做缓存、秒杀任务队列、网站访问统计等
去https://redis.io官网下载的只有Linux系统的redis，先用着黑马的Windows绿色版本，等后边部署Linux的时候再使用
key，value； 其中key都是字符串，value有5种不同的数据结构
value：
​	1.字符串类型string
​	2.哈希类型hash：map格式
​	3.列表类型list： linkedlist格式
​	4.集合类型set
​	5.有序集合类型sortedset
**命令操作 ** (更多详细的操作在redis官网文档中有)
字符串类型 string
1. 存储： set key value 127.0.0.1:6379&gt; set username zhangsan OK 2. 获取： get key 127.0.0.1:6379&gt; get username &quot;zhangsan&quot; 3. 删除： del key 127.0.0.1:6379&gt; del age (integer) 1  哈希类型 hash
  存储： hset key field value 127.0.0.1:6379&gt; hset myhash username lisi (integer) 1 127."/>

    <meta property="og:title" content="Redis&amp;Jedis" />
<meta property="og:description" content="redis&amp;Jedis redis 概念：一款高性能的NOSQL系列的非关系型数据库
关系型数据库：MySQL、Oracle…
​	使用表单存储数据，数据之间有关联关系，数据存储在硬盘的文件上
非关系型数据库(NOSQL): redis, hbase…
​	使用键值对去存储数据，数据之间没有关联关系，数据存储在内存中
两种数据库并非对立而是互补，关系型用来做数据库，NOSQL用于做缓存、秒杀任务队列、网站访问统计等
去https://redis.io官网下载的只有Linux系统的redis，先用着黑马的Windows绿色版本，等后边部署Linux的时候再使用
key，value； 其中key都是字符串，value有5种不同的数据结构
value：
​	1.字符串类型string
​	2.哈希类型hash：map格式
​	3.列表类型list： linkedlist格式
​	4.集合类型set
​	5.有序集合类型sortedset
**命令操作 ** (更多详细的操作在redis官网文档中有)
字符串类型 string
1. 存储： set key value 127.0.0.1:6379&gt; set username zhangsan OK 2. 获取： get key 127.0.0.1:6379&gt; get username &quot;zhangsan&quot; 3. 删除： del key 127.0.0.1:6379&gt; del age (integer) 1  哈希类型 hash
  存储： hset key field value 127.0.0.1:6379&gt; hset myhash username lisi (integer) 1 127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zyooo.github.io/javadairy/redisjedis/" />
<meta property="article:published_time" content="2021-10-09T11:46:30+08:00" />
<meta property="article:modified_time" content="2021-10-09T11:46:30+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://zyooo.github.io"><img class="app-header-avatar" src="/avatar.jpg" alt="Ray" /></a>
      <h1>Ray</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/note/">NOTE</a>
             - 
          
          <a class="app-header-menu-item" href="/leetcodedairy/">LeetCodeDairy</a>
             - 
          
          <a class="app-header-menu-item" href="/bugs/">Bugs</a>
             - 
          
          <a class="app-header-menu-item" href="/javadairy/">JavaDairy</a>
      </nav>
      <p>What everyonne you can do,just do it.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/zyooo" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>My Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Redis&amp;Jedis</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 9, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="redisjedis">redis&amp;Jedis</h1>
<h2 id="redis">redis</h2>
<p><strong>概念：一款高性能的NOSQL系列的非关系型数据库</strong></p>
<p>关系型数据库：MySQL、Oracle…</p>
<p>​	使用表单存储数据，数据之间有关联关系，数据存储在硬盘的文件上</p>
<p>非关系型数据库(NOSQL): redis, hbase…</p>
<p>​	使用键值对去存储数据，数据之间没有关联关系，数据存储在内存中</p>
<p>两种数据库并非对立而是互补，关系型用来做数据库，NOSQL用于做缓存、秒杀任务队列、网站访问统计等</p>
<p>去https://redis.io官网下载的只有Linux系统的redis，先用着黑马的Windows绿色版本，等后边部署Linux的时候再使用</p>
<p><strong>key，value； 其中key都是字符串，value有5种不同的数据结构</strong></p>
<p>value：</p>
<p>​	1.字符串类型string</p>
<p>​	2.哈希类型hash：map格式</p>
<p>​	3.列表类型list： linkedlist格式</p>
<p>​	4.集合类型set</p>
<p>​	5.有序集合类型sortedset</p>
<p><img src="https://i.loli.net/2021/10/09/pa49gX1hoAZtDJ3.png" alt="image-20211009092128312"></p>
<h3 id="命令操作-">**命令操作 **</h3>
<p><strong>(更多详细的操作在redis官网文档中有)</strong></p>
<p><strong>字符串类型 string</strong></p>
<pre><code>1. 存储： set key value
    127.0.0.1:6379&gt; set username zhangsan
    OK
2. 获取： get key
    127.0.0.1:6379&gt; get username
    &quot;zhangsan&quot;
3. 删除： del key
    127.0.0.1:6379&gt; del age
    (integer) 1
</code></pre>
<p><strong>哈希类型 hash</strong></p>
<ol>
<li>
<p>存储： hset key field value
127.0.0.1:6379&gt; hset myhash username lisi
(integer) 1
127.0.0.1:6379&gt; hset myhash password 123
(integer) 1</p>
</li>
<li>
<p>获取：</p>
<ul>
<li>hget key field: 获取指定的field对应的值
127.0.0.1:6379&gt; hget myhash username
&ldquo;lisi&rdquo;</li>
<li>hgetall key：获取所有的field和value
127.0.0.1:6379&gt; hgetall myhash
<ol>
<li>&ldquo;username&rdquo;</li>
<li>&ldquo;lisi&rdquo;</li>
<li>&ldquo;password&rdquo;</li>
<li>&ldquo;123&rdquo;</li>
</ol>
</li>
</ul>
</li>
<li>
<p>删除： hdel key field
127.0.0.1:6379&gt; hdel myhash username
(integer) 1</p>
</li>
</ol>
<p><strong>列表类型 list:可以添加一个元素到列表的头部（左边）或者尾部（右边）</strong></p>
<ol>
<li>
<p>添加：</p>
<ol>
<li>
<p>lpush key value: 将元素加入列表左表</p>
</li>
<li>
<p>rpush key value：将元素加入列表右边</p>
<p>127.0.0.1:6379&gt; lpush myList a
(integer) 1
127.0.0.1:6379&gt; lpush myList b
(integer) 2
127.0.0.1:6379&gt; rpush myList c
(integer) 3</p>
</li>
</ol>
</li>
<li>
<p>获取：</p>
<ul>
<li>lrange key start end ：范围获取
127.0.0.1:6379&gt; lrange myList 0 -1
<ol>
<li>&ldquo;b&rdquo;</li>
<li>&ldquo;a&rdquo;</li>
<li>&ldquo;c&rdquo;</li>
</ol>
</li>
</ul>
</li>
<li>
<p>删除：</p>
<ul>
<li>
<p>lpop key： 删除列表最左边的元素，并将元素返回</p>
</li>
<li>
<p>rpop key： 删除列表最右边的元素，并将元素返回</p>
</li>
</ul>
</li>
</ol>
<p><strong>集合类型 set ： 不允许重复元素</strong>
1. 存储：sadd key value
127.0.0.1:6379&gt; sadd myset a
(integer) 1
127.0.0.1:6379&gt; sadd myset a
(integer) 0
2. 获取：smembers key:获取set集合中所有元素
127.0.0.1:6379&gt; smembers myset
1) &ldquo;a&rdquo;
3. 删除：srem key value:删除set集合中的某个元素
127.0.0.1:6379&gt; srem myset a
(integer) 1</p>
<p><strong>有序集合类型 sortedset</strong>：不允许重复元素，且元素有顺序.每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<ol>
<li>
<p>存储：zadd key score value
127.0.0.1:6379&gt; zadd mysort 60 zhangsan
(integer) 1
127.0.0.1:6379&gt; zadd mysort 50 lisi
(integer) 1
127.0.0.1:6379&gt; zadd mysort 80 wangwu
(integer) 1</p>
</li>
<li>
<p>获取：zrange key start end [withscores]
127.0.0.1:6379&gt; zrange mysort 0 -1</p>
<ol>
<li>&ldquo;lisi&rdquo;</li>
<li>&ldquo;zhangsan&rdquo;</li>
<li>&ldquo;wangwu&rdquo;</li>
</ol>
<p>127.0.0.1:6379&gt; zrange mysort 0 -1 withscores</p>
<ol>
<li>&ldquo;zhangsan&rdquo;</li>
<li>&ldquo;60&rdquo;</li>
<li>&ldquo;wangwu&rdquo;</li>
<li>&ldquo;80&rdquo;</li>
<li>&ldquo;lisi&rdquo;</li>
<li>&ldquo;500&rdquo;</li>
</ol>
</li>
<li>
<p>删除：zrem key value
127.0.0.1:6379&gt; zrem mysort lisi
(integer) 1</p>
</li>
</ol>
<p><strong>通用命令</strong></p>
<ol>
<li>keys * : 查询所有的键</li>
<li>type key ： 获取键对应的value的类型</li>
<li>del key：删除指定的key value</li>
</ol>
<h3 id="持久化"><strong>持久化</strong></h3>
<ol>
<li>
<p>redis是一个内存数据库，当redis服务器重启，获取电脑重启，数据会丢失，我们可以将redis内存中的数据持久化保存到硬盘的文件中。</p>
</li>
<li>
<p>redis持久化机制：</p>
<ol>
<li>
<p>RDB：默认方式，不需要进行配置，默认就使用这种机制</p>
<ul>
<li>在一定的间隔时间中，检测key的变化情况，然后持久化数据</li>
</ul>
<ol>
<li>
<p>编辑redis.windwos.conf文件</p>
<p>after 900 sec (15 min) if at least 1 key changed</p>
<p>save 900 1</p>
<p>after 300 sec (5 min) if at least 10 keys changed</p>
<p>save 300 10</p>
<p>after 60 sec if at least 10000 keys changed</p>
<p>save 60 10000</p>
</li>
<li>
<p>重新启动redis服务器，并指定配置文件名称
F:\NewStudy\JavaWeb\day23_redis\资料\redis\windows-64\redis-2.8.9\redis.windows.conf&gt;redis-server.exe redis.windows.conf</p>
</li>
</ol>
</li>
<li>
<p>AOF：日志记录的方式，可以记录每一条命令的操作。可以每一次命令操作后，持久化数据</p>
<ol>
<li>
<p>编辑redis.windwos.conf文件
appendonly no（关闭aof） &ndash;&gt; appendonly yes （开启aof）</p>
<p>appendfsync always ： 每一次操作都进行持久化</p>
<p>appendfsync everysec ： 每隔一秒进行一次持久化</p>
<p>appendfsync no	 ： 不进行持久化</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><strong>遇到个问题：</strong> 在第一次正常启动之后，配置完conf里的save，再次开启server秒退。</p>
<p>错误信息：QForkMasterInit: system error caught. error code=0x000005af, message=VirtualAllocEx failed.: unknown error</p>
<p>**原因：**未设置redis最大内存</p>
<p>**解决：**在conf中最下面加入</p>
<pre><code>maxmemory 268435456
maxheap 314572800
</code></pre><p>再次启动正常</p>
<h2 id="jedis">Jedis</h2>
<pre><code>Java客户端 Jedis
    * Jedis: 一款java操作redis数据库的工具.
    * 使用步骤：
        1. 下载jedis的jar包
        2. 使用
            //1. 获取连接
            Jedis jedis = new Jedis(&quot;localhost&quot;,6379);
            //2. 操作
            jedis.set(&quot;username&quot;,&quot;zhangsan&quot;);
            //3. 关闭连接
            jedis.close();
    * Jedis操作各种redis中的数据结构
        1) 字符串类型 string
            set
            get
			
             //1. 获取连接
            Jedis jedis = new Jedis();//如果使用空参构造，默认值 &quot;localhost&quot;,6379端口
            //2. 操作
            //存储
            jedis.set(&quot;username&quot;,&quot;zhangsan&quot;);
            //获取
            String username = jedis.get(&quot;username&quot;);
            System.out.println(username);
	
            //可以使用setex()方法存储可以指定过期时间的 key value
            jedis.setex(&quot;activecode&quot;,20,&quot;hehe&quot;);//将activecode：hehe键值对存入redis，并且20秒后自动删除该键值对
	
            //3. 关闭连接
            jedis.close();

        2) 哈希类型 hash ： map格式  
            hset
            hget
            hgetAll
            //1. 获取连接
            Jedis jedis = new Jedis();//如果使用空参构造，默认值 &quot;localhost&quot;,6379端口
            //2. 操作
            // 存储hash
            jedis.hset(&quot;user&quot;,&quot;name&quot;,&quot;lisi&quot;);
            jedis.hset(&quot;user&quot;,&quot;age&quot;,&quot;23&quot;);
            jedis.hset(&quot;user&quot;,&quot;gender&quot;,&quot;female&quot;);
	
            // 获取hash
            String name = jedis.hget(&quot;user&quot;, &quot;name&quot;);
            System.out.println(name);
</code></pre>
<p>​</p>
<pre><code>            // 获取hash的所有map中的数据
            Map&lt;String, String&gt; user = jedis.hgetAll(&quot;user&quot;);
	
            // keyset
            Set&lt;String&gt; keySet = user.keySet();
            for (String key : keySet) {
                //获取value
                String value = user.get(key);
                System.out.println(key + &quot;:&quot; + value);
            }
	
            //3. 关闭连接
            jedis.close();


        3) 列表类型 list ： linkedlist格式。支持重复元素
            lpush / rpush
            lpop / rpop
            lrange start end : 范围获取
			
             //1. 获取连接
            Jedis jedis = new Jedis();//如果使用空参构造，默认值 &quot;localhost&quot;,6379端口
            //2. 操作
            // list 存储
            jedis.lpush(&quot;mylist&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);//从左边存
            jedis.rpush(&quot;mylist&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);//从右边存
	
            // list 范围获取
            List&lt;String&gt; mylist = jedis.lrange(&quot;mylist&quot;, 0, -1);
            System.out.println(mylist);
	        
            // list 弹出
            String element1 = jedis.lpop(&quot;mylist&quot;);//c
            System.out.println(element1);
	
            String element2 = jedis.rpop(&quot;mylist&quot;);//c
            System.out.println(element2);
	
            // list 范围获取
            List&lt;String&gt; mylist2 = jedis.lrange(&quot;mylist&quot;, 0, -1);
            System.out.println(mylist2);
	
            //3. 关闭连接
            jedis.close();


        4) 集合类型 set  ： 不允许重复元素
            sadd
            smembers:获取所有元素

            //1. 获取连接
            Jedis jedis = new Jedis();//如果使用空参构造，默认值 &quot;localhost&quot;,6379端口
            //2. 操作
</code></pre>
<p>​</p>
<pre><code>            // set 存储
            jedis.sadd(&quot;myset&quot;,&quot;java&quot;,&quot;php&quot;,&quot;c++&quot;);
	
            // set 获取
            Set&lt;String&gt; myset = jedis.smembers(&quot;myset&quot;);
            System.out.println(myset);
	
            //3. 关闭连接
            jedis.close();
        5) 有序集合类型 sortedset：不允许重复元素，且元素有顺序
            zadd
            zrange

            //1. 获取连接
            Jedis jedis = new Jedis();//如果使用空参构造，默认值 &quot;localhost&quot;,6379端口
            //2. 操作
            // sortedset 存储
            jedis.zadd(&quot;mysortedset&quot;,3,&quot;亚瑟&quot;);
            jedis.zadd(&quot;mysortedset&quot;,30,&quot;后裔&quot;);
            jedis.zadd(&quot;mysortedset&quot;,55,&quot;孙悟空&quot;);
	
            // sortedset 获取
            Set&lt;String&gt; mysortedset = jedis.zrange(&quot;mysortedset&quot;, 0, -1);
	
            System.out.println(mysortedset);
</code></pre>
<p>​</p>
<pre><code>            //3. 关闭连接
            jedis.close();
</code></pre>
<p>​</p>
<pre><code>    * jedis连接池： JedisPool
        * 使用：
            1. 创建JedisPool连接池对象
            2. 调用方法 getResource()方法获取Jedis连接
                //0.创建一个配置对象
                JedisPoolConfig config = new JedisPoolConfig();
                config.setMaxTotal(50);
                config.setMaxIdle(10);
		
                //1.创建Jedis连接池对象
                JedisPool jedisPool = new JedisPool(config,&quot;localhost&quot;,6379);
		
                //2.获取连接
                Jedis jedis = jedisPool.getResource();
                //3. 使用
                jedis.set(&quot;hehe&quot;,&quot;heihei&quot;);
</code></pre>
<p>​</p>
<pre><code>                //4. 关闭 归还到连接池中
                jedis.close();
		
        * 连接池工具类
            public class JedisPoolUtils {

                private static JedisPool jedisPool;
			
                static{
                    //读取配置文件
                    InputStream is = JedisPoolUtils.class.getClassLoader().getResourceAsStream(&quot;jedis.properties&quot;);
                    //创建Properties对象
                    Properties pro = new Properties();
                    //关联文件
                    try {
                        pro.load(is);
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    //获取数据，设置到JedisPoolConfig中
                    JedisPoolConfig config = new JedisPoolConfig();
                    config.setMaxTotal(Integer.parseInt(pro.getProperty(&quot;maxTotal&quot;)));
                    config.setMaxIdle(Integer.parseInt(pro.getProperty(&quot;maxIdle&quot;)));
			
                    //初始化JedisPool
                    jedisPool = new JedisPool(config,pro.getProperty(&quot;host&quot;),Integer.parseInt(pro.getProperty(&quot;port&quot;)));
</code></pre>
<p>​			
​</p>
<pre><code>                }
</code></pre>
<p>​</p>
<pre><code>                /**
                 * 获取连接方法
                 */
                public static Jedis getJedis(){
                    return jedisPool.getResource();
                }
            }
</code></pre>
<h2 id="案例">案例：</h2>
<pre><code>案例需求：
    1. 提供index.html页面，页面中有一个省份 下拉列表
    2. 当 页面加载完成后 发送ajax请求，加载所有省份


* 注意：使用redis缓存一些不经常发生变化的数据。
    * 数据库的数据一旦发生改变，则需要更新缓存。
        * 数据库的表执行 增删改的相关操作，需要将redis缓存数据情况，再次存入
        * 在service对应的增删改方法中，将redis数据删除。
</code></pre>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
